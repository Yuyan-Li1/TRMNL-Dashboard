name: Morning Data Pre-fetch

on:
  schedule:
    # Run at ~7:40 AM Sydney time (UTC+11 in summer, UTC+10 in winter)
    # Two entries cover both AEDT and AEST â€” one will fire an hour
    # early/late depending on DST, but that's fine for a pre-fetch.
    # Mon-Fri Sydney morning = Sun-Thu UTC night
    - cron: '40 20 * * 0-4'  # 7:40 AM AEDT / 6:40 AM AEST (Mon-Fri Sydney)
    - cron: '40 21 * * 0-4'  # 8:40 AM AEDT / 7:40 AM AEST (Mon-Fri Sydney)

  workflow_dispatch:

jobs:
  prefetch:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Pre-fetch morning data
        run: |
          echo "Pre-fetching data for morning dashboard..."

          # Trigger refresh
          curl -s -X POST \
            "https://${{ secrets.VERCEL_URL }}/api/refresh" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"

          # Wait a moment and trigger again to warm caches
          sleep 30
          curl -s -X POST \
            "https://${{ secrets.VERCEL_URL }}/api/refresh" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"

          echo "Morning pre-fetch complete"
