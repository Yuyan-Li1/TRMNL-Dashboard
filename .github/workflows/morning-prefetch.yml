name: Morning Data Pre-fetch

on:
  schedule:
    # Run at ~6:00 AM Sydney time (UTC+11 in summer, UTC+10 in winter)
    # Two entries cover both AEDT and AEST â€” one will fire an hour
    # early/late depending on DST, but that's fine for a pre-fetch.
    - cron: '0 19 * * 1-5'  # 6 AM AEDT / 5 AM AEST (Mon-Fri)
    - cron: '0 20 * * 1-5'  # 7 AM AEDT / 6 AM AEST (Mon-Fri)

  workflow_dispatch:

jobs:
  prefetch:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Pre-fetch morning data
        run: |
          echo "Pre-fetching data for morning dashboard..."

          # Trigger refresh
          curl -s -X POST \
            "https://${{ secrets.VERCEL_URL }}/api/refresh" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"

          # Wait a moment and trigger again to warm caches
          sleep 30
          curl -s -X POST \
            "https://${{ secrets.VERCEL_URL }}/api/refresh" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"

          echo "Morning pre-fetch complete"
